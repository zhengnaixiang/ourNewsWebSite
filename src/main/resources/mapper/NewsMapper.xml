<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qf.newsPaper.mapper.NewsMapper">

    <!--结果集-->
    <resultMap id="newsPaperMap" type="com.qf.newsPaper.dto.NewsPaperAndAuthor">
        <id column="np_id" property="np_id"></id>
        <result column="user_alias" property="alias"></result>
        <result column="np_title" property="np_title"></result>
        <result column="np_date" property="np_date"></result>
        <result column="np_image" property="np_image"></result>
        <result column="np_content" property="np_content"></result>
    </resultMap>

    <!--点击新闻，将新闻页面所需东西返回给前端-->
    <select id="acquireNewsByNewsId" parameterType="int" resultType="com.qf.newsPaper.dto.NewsPaperAndAuthor">
    SELECT newp.*,userin.user_imageUrl from newpaper newp,userinfo userin
    where newp.user_id=userin.user_id and np_status=1 and newp.np_id=#{np_id}
    </select>

    <!--修改新闻的相关数据-->
    <update id="updateNewsData" parameterType="com.qf.newsPaper.vo.NewsPaperData" >
        UPDATE newpaper
        <set>
            <if test="np_reading != null and np_reading != ''">
                np_reading=#{np_reading},
            </if>
            <if test="np_likes != null and np_likes != ''">
                np_likes = #{np_likes}
            </if>
        </set>
        where  np_id=#{np_id}
    </update>

    <!--通过点击类别，获取类别id，得到一定数量的相关类新闻，展示到前端页面-->
    <select id="getNewsByCategoryId" parameterType="int" resultMap="newsPaperMap">
    SELECT newp.np_id,newp.user_alias,newp.np_title,newp.np_date,newp.np_image,newp.np_content
    from newpaper newp,classes class,classes_newpaper class_newp where
    newp.np_id=class_newp.np_id and class_newp.class_id=class.class_id and newp.np_status=1 and class.class_id=#{class_id}
    </select>
</mapper>