<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>内容管理</title>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/main.css">
    <style>
        .tree li {
            list-style-type: none;
            cursor:pointer;
        }
        table tbody tr:nth-child(odd){background:#F4F4F4;}
        table tbody td:nth-child(even){color:#C00;}
    </style>
</head>
<body>
<div id="top"></div>
<div class="container-fluid">
    <div class="row">
        <div id="left"></div>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title"><i class="glyphicon glyphicon-th"></i> 数据列表</h3>
                </div>
                <div class="panel-body">
                    <form class="form-inline" role="form" style="float:left;">
                        <div class="form-group has-feedback">
                            <!--<div class="input-group">-->
                            <!--<div class="input-group-addon">-->
                            <!--<select id="search_id">-->
                            <!--<option>1</option>-->
                            <!--<option>2</option>-->
                            <!--</select>-->
                            <!--</div>&nbsp;&nbsp;&nbsp;&nbsp;-->
                            <!--<input class="form-control has-success" type="text" placeholder="搜索新闻" width="100">-->
                            <!--</div>-->
                            <div class="input-group">
                                <div class="input-group-addon">标题/时间/类别/点赞数/评论数</div>
                                <input id="titleText" value="" class="form-control has-success" type="text" placeholder="请输入查询条件">
                            </div>
                            <!-- <div class="input-group">
                                 <div class="input-group-addon">作者</div>
                                 <input id="writerText" class="form-control has-success" type="text" placeholder="请输入查询条件">
                             </div>-->
                            <!--<div class="input-group">
                                <div class="input-group-addon">时间</div>
                                <input id="dateText" class="form-control has-success" type="text" placeholder="请输入查询条件">
                            </div>-->
                        </div>
                        <button type="button" class="btn btn-warning"><i class="glyphicon glyphicon-search"></i> 查询</button>
                    </form>
                    <button type="button" class="btn btn-danger" style="float:right;margin-left:10px;" id="batchAll"><i class=" glyphicon glyphicon-remove"></i> 删除</button>
                    <button type="button" class="btn btn-primary" style="float:right;" onclick="window.location.href='writeNews.html'"><i class="glyphicon glyphicon-plus"></i> 新增</button>
                    <br>
                    <hr style="clear:both;">
                    <div class="table-responsive">
                        <table class="table  table-bordered">
                            <thead>
                            <tr >
                                <th width="30">ID</th>
                                <th width="30"><input id="BigFlag" type="checkbox"></th>
                                <th>标题</th>
                                <th>时间</th>
                                <th>所属类别</th>
                                <th>点赞数</th>
                                <th>评论数</th>
                                <th width="200">操作</th>
                            </tr>
                            </thead>
                            <tbody id="tab">
                            <tr>
                                <td>id</td>
                                <td><input class="ids" type="checkbox" value="id"/> </td>
                                <td>京雄城际铁路北京段具备铺轨条件</td>
                                <td>2019-04-13 00:44:00</td>
                                <td>国内、时事、工业</td>
                                <td>999</td>
                                <td>888</td>
                                <td>
                                    <button type="button" class="btn btn-primary btn-xs" onclick="toReadNews()"><i class=" glyphicon glyphicon-check"></i>查看</button>
                                    <button type="button" class="btn btn-danger btn-xs"><i class=" glyphicon glyphicon-remove"></i>删除</button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <tfoot >
                        <div class="row">
                            <ul class="pagination" id="pagination">
                                <li id="btns">
                                </li>
                            </ul>
                            <p class="text-primary">当前第:<span id="currentPage"></span>页 共计<span
                                    id="totalPage"></span>页&nbsp;&nbsp;&nbsp;<input type="text" id="t" style="width: 25px;height: 22px">
                                <button class="btn-primary" onclick="goto()">跳转</button>
                            </p>
                            <p class="text-primary">总记录数:<span id="totalNums"></span></p>
                        </div>
                        </tfoot>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script src="jquery/jquery-2.1.1.min.js"></script>
<script src="bootstrap/js/bootstrap.min.js"></script>
<script src="script/docs.min.js"></script>
<script type="text/javascript">
    $(function () {
        $("#top").load("head.html");
        $("#left").load("left.html");
    });


    /*通过ajax，将该用户所撰写的新闻，返回到该页面*/
    /*进行页面数据的初始化加载*/
    function init(currentPage, pageSize) {
        $.ajax({
            type: 'POST',
            url: 'getAuthorNewsByUserId',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({
                "currentPage": currentPage,
                "pageSize": pageSize,
            }),
            success: function (responseText) {
                $("#tab").empty("");
                console.log(responseText);
                for (var i = 0; i < responseText.list.length; i++) {
                    $("#tab").append("   <tr>\n" +
                        "                                <td>"+responseText.list[i].np_id+"</td>\n" +
                        "                                <td><input class=\"ids\" type=\"checkbox\" value=\"id\"/> </td>\n" +
                        "                                <td>"+responseText.list[i].np_title+"</td>\n" +
                        "                                <td>"+responseText.list[i].np_date+"</td>\n" +
                        "                                <td>"+responseText.list[i].class_name+"</td>\n" +
                        "                                <td>"+responseText.list[i].np_likes+"</td>\n" +
                        "                                <td>"+responseText.list[i].np_reading+"</td>\n" +
                        "                                <td>\n" +
                        "                                    <button type=\"button\" class=\"btn btn-primary btn-xs\" onclick='toReadNews("+responseText.list[i].np_id+")'><i class=\" glyphicon glyphicon-check\"></i>查看</button>\n" +
                        "                                    <button type=\"button\" class=\"btn btn-danger btn-xs\" onclick='deleteObject("+responseText.list[i].np_id+")'><i class=\" glyphicon glyphicon-remove\"></i>删除</button>\n" +
                        "                                </td>\n" +
                        "                            </tr>");
                }

                //动态生成页数
                for (var i = 0; i < responseText.lastPage; i++) {
                    if (i == 0) {
                        //首页
                        var buttonFirst = $("<button onclick='goNormal(" + responseText.firstPage + ")' class='btn-primary'>首页</button>");
                        //是否存有上页
                        if (responseText.pageNum == 1) {
                            var buttonPrep = $("<button onclick='goNormal(" + responseText.prePage + ")' class=\"btn-primary\" disabled='disabled'>上一页</button>")
                        } else {
                            var buttonPrep = $("<button onclick='goNormal(" + responseText.prePage + ")' class=\"btn-primary\">上一页</button>")
                        }
                        $("#btns").append(buttonFirst);
                        $("#btns").append(buttonPrep);
                    }
                    if (i == responseText.pageNum - 1) {
                        var button = $("<button onclick='goNormal(" + (i + 1) + ")' class=\"btn-success\">" + (i + 1) + "</button>")
                    } else {
                        var button = $("<button onclick='goNormal(" + (i + 1) + ")' class=\"btn-primary\">" + (i + 1) + "</button>")
                    }
                    $("#btns").append(button);
                    if (i == responseText.lastPage - 1) {
                        //尾页
                        var buttonEnd = $("<button onclick='goNormal(" + responseText.lastPage + ")' class=\"btn-primary\">尾页</button>");
                        if (responseText.pageNum == responseText.lastPage) {
                            var buttonNext = $("<button onclick='goNormal(" + responseText.nextPage + ")' class=\"btn-primary\" disabled='disabled'>下一页</button>")
                        } else {
                            var buttonNext = $("<button onclick='goNormal(" + responseText.nextPage + ")' class=\"btn-primary\">下一页</button>")
                        }
                        $("#btns").append(buttonNext);
                        $("#btns").append(buttonEnd);
                    }

                }
                //当前页数
                $("#currentPage").html(responseText.pageNum);
                //总页数
                $("#totalPage").html(responseText.lastPage);
                //总记录数
                $("#totalNums").html(responseText.total);
            },
            error: function (message) {
                console.log(message);
            },
            dataType: 'json'
        });

        var total = $(".ids").length;
        var count = 0;
        var flag;
        // 全选同步
        $("#BigFlag").click(function () {
            flag = $(this).prop("checked");
            $(".ids").prop("checked", flag);
            if (flag){
                count = total;
            } else {
                count = 0;
            }
        });

        // 多选操作
        $(".ids").click(function () {
            flag = $(this).prop("checked");
            if (flag) {
                if (++count == total) {
                    $("#BigFlag").prop("checked", true);
                }
            } else {
                count--;
                $("#BigFlag").prop("checked", false);
            }
        });

    }

    /*调用函数，显示数据*/
    init(1,5);
    /*下一页或者上一页的操作*/
    function goNormal(n) {
        $("#tab tr:not(:first)").empty("");
        $("#btns").find("button").remove();
        init(n, 5);
    }

    /*指定页面跳转的操作*/
    function goto() {
        $("#tab tr:not(:first)").empty("");
        $("#btns").find("button").remove();
        init($("#t").val(), 5);
    }

    function toReadNews (np_id){
        var url="singlepage.html?np_id="+np_id;
        window.location.href=url;
    }

    /*进行批量删除的操作*/
    $("#batchAll").click(function () {
        //1.创建一个数组存储多个id属性
        var ids = new Array();
        //2.获取用户选中的对象
        $(".ids:checked").each(function () {
            //获取val值
            var id = $(this).val();
            //把val值添加进数组
            ids.push(id);
        })

        $.ajax({
            type: 'POST',
            url:  'updateNewsStatusToZero',
            contentType: "application/json; charset=utf-8",
            data:JSON.stringify({
                "newsId":ids
            }) ,
            success: function(responseText){
                console.log(responseText);
                if (responseText==true){
                    window.location.href="contentManage.html";
                } else{
                    alert("删除失败");
                }
            } ,
            error:function (message) {
                console.log(message);
            },
            dataType: 'json'
        });
    });

    /*进行单个删除的操作*/
    function deleteObject(np_id) {
        $.ajax({
            type: 'POST',
            url:  'deleteSingleNews',
            contentType: "application/json; charset=utf-8",
            data:JSON.stringify({
                "np_id":np_id
            }) ,
            success: function(responseText){
                console.log(responseText);
                if (responseText==true){
                    window.location.href="contentManage.html";
                } else{
                    alert("删除失败");
                }
            } ,
            error:function (message) {
                console.log(message);
            },
            dataType: 'json'
        });
    }
</script>
</html>